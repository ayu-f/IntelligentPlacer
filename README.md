# Лабораторная работа Intelligent placer

# [Пример работы](intelligent_placer.ipynb) 

# Постановка задачи
Дан набор фотографий предметов. Также даны фотографии многоугольника, нарисованного на белом листе с предметами из данного набора.
Необходимо определить, поместятся ли предметы в многоугольник, не перекрывая друг друга.

## Формат входных/выходных данных
Программа на вход получает изображение формата .jpg, на котором расположен нарисованный многоугольник и предметы, 
которые необходимо проверить(по одну сторону от многоугольника)

## Требования к многоугольнику
* Многоугольник должен быть изображен на белом листе бумаги без лишних рисунков
* Многоугольник должен быть нарисованн черным маркером или черной ручкой
* Линии мноугольника должны быть четко прямыми, углы ярко выражены
* Многоугольник должен быть замкнут
* Многоугольник должен быть выпуклым
* Многоугольник расположен по одну сторону от всех предметов
* Не больше 5 вершин
* Белый лист, на котором нарисован многоугольник, должен полностью помещаться на фотографии
* Многоугольник должен быть строго справа относительно предметов

## Требования к предметам
* Рассматриваются предметы из заранее предложенного набора, в котором они располагаются на белом листе
* Предметы не перекрывают друг друга на фотографии
* Тени от предметов не должны быть сильной интенсивности
* Поверхность, на которой изображены предметы и многоугольник, должна быть хорошо освещена, предметы хорошо различимы на ней
* Предметы не пересекаются с многоугольником
* Без ярких бликов

## Требования к изображениям
* Изображения цветные, формата .jpg
* Разрешение full hd и меньше
* Угол между камерой и перпендикуляром к поверхности должен быть прямой или почти прямой (до 10 градусов)

# План работы

## Поиск границы многоугольника и предметов
1. Сгладить изображение фильтром гаусса (используя skimage.filters.gaussian)
2. Найти границы с помощью детектора Canny (используя skimage.feature.canny)
3. Найти маску изображения, используя морфологические операции
4. Получить свойства предметов (их координаты границ). Многоугольником будет являться объект с наибольшей координатой Х(или с наибольшей интенсивностью полученных предметов(так как он белый)).
5. Условно обрезать изображение на область многоугольника и остальных предметов
6. Найти особые точки объектов и многоугольника

## Поиск границы предметов из набора данных
1. Бинаризация изображения. Из требований к предметам и фону, можно сделать вывод, что объекты будут более темными относительно фона.
   Предположительно, подойдет один из фильтров (теоретически Оцу/Минимум). Уточнится во время реализации.
2. С помощью морфологических операций сгладить маску (используя skimage.morphology)
3. Применить маску к изображению
4. Найти особые точки предметов
5. Будем счиать, что один пиксель - один элемент матрицы

## Размещение предметов в многоугольник
1. Найдем площади предметов и многоугольника
2. Найдем сумму площадей предметов и сравним с площадью многоугольника. Если сумма превышает - возвращаем сразу False
3. Отсортируем площади предметов по невозрастанию
4. Заполним маску многогоугольника 1(True), а маски предметов 0(False)
5. Увеличим область многоугольника 1-ми во вне, чтобы быстрее обрабатывать поворот изображений
6. Будем пытаться разместить предметы последовательно, проходя по отсортированному по площадям массиву предметов
   Проходим по x и y многоугольника и применеям операцию AND. С помощью нее можем определить, перескается ли текущий объект с 
   границами других предметов или многоугольника. Если элемент помещается, применяем операцию OR.
7. Если на каком-то шаге не удается разместить объект, то пробуем повернуть его на некоторый градус от 0 до 360 против часовой стрелки.
   Если при повороте не удалось разместить предмет, перемещаем его с некоторым шагом влево/вниз.
8. Если удается разместить все предметы - возвращаем True, иначе False

# Возможная оптимизация алгоритма
1. При неудачном размещении объекта поворачивать не на рандмоный угол, а на угол между предметом и границей многоугольника
2. Вычислять максимальное расстояние от центра предмета до его границы - площадь может быть меньше многоугольника, однако параметр(длина/ширина) не помещаться.
# Используемые предметы
[Ссылка на предметы](images/objects)

# Датасет
[Ссылка на датасет](images/dataset).
---
Фисюк Алексей, группа 5030102/90201
